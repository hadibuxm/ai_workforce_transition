{% extends "base.html" %}
{% load assessment_extras %}

{% block title %}Transition Assessment Tool{% endblock %}

{% block content %}
<div class="dashboard">
    <aside class="dashboard-sidebar">
        <section class="panel panel--compact">
            <h2>Transition Assessment</h2>
            <p class="panel-lead">
                Upload a role profile or paste a role description and we&#39;ll evaluate the role for AI transition readiness.
            </p>
            <form method="post" enctype="multipart/form-data" class="assessment-form">
                {% csrf_token %}
                {% if form.non_field_errors %}
                    <div class="form-errors">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="form-field">
                    <label for="{{ form.role_document.id_for_label }}">{{ form.role_document.label }}</label>
                    {{ form.role_document }}
                    {% if form.role_document.help_text %}
                        <small>{{ form.role_document.help_text }}</small>
                    {% endif %}
                    {% for error in form.role_document.errors %}
                        <small class="field-error">{{ error }}</small>
                    {% endfor %}
                </div>
                <div class="form-field">
                    <label for="{{ form.role_description.id_for_label }}">{{ form.role_description.label }}</label>
                    {{ form.role_description }}
                    {% if form.role_description.help_text %}
                        <small>{{ form.role_description.help_text }}</small>
                    {% endif %}
                    {% for error in form.role_description.errors %}
                        <small class="field-error">{{ error }}</small>
                    {% endfor %}
                </div>

                <p class="form-hint">Provide either a role document upload or a role description, but not both.</p>

                <button type="submit" class="btn-primary">Run Assessment</button>
                <button type="button" class="btn-secondary" id="reload-btn">Reload</button>
            </form>
        </section>
        <section class="panel panel--compact info-card">
            <h3>What you&#39;ll receive</h3>
            <ul>
                <li>Automation readiness score</li>
                <li>Projected time horizon for transition</li>
                <li>Risk profile across compliance, financials, and operations</li>
                <li>Recommended action and follow-up timing</li>
            </ul>
        </section>
    </aside>

    <section class="dashboard-main">
        {% if result %}
            <div id="assessment-results">
                <div class="panel summary-header">
                    <div>
                        <p class="summary-label">Transition Readiness Score</p>
                        <p class="summary-score">{{ result.readiness_score }}</p>
                        <p class="summary-sub">{{ result.readiness_category }}</p>
                    </div>
                    <div class="summary-meta">
                        <div>
                            <span class="summary-meta__label">Time Horizon</span>
                            <span class="summary-meta__value">{{ result.time_horizon }}</span>
                        </div>
                        <div>
                            <span class="summary-meta__label">Risk Score</span>
                            <span class="summary-meta__value">{{ result.risk_score }}</span>
                        </div>
                        <div>
                            <span class="summary-meta__label">FTE Savings</span>
                            <span class="summary-meta__value">{{ result.fte_savings_percentage }}% of tasks can be performed by AI</span>
                        </div>
                        <div>
                            <span class="summary-meta__label">Recommendation</span>
                            <span class="summary-meta__value">{{ result.recommendation }}</span>
                        </div>
                    </div>
                </div>
                <section class="panel panel--compact">
                    <h3>Score Guide</h3>
                    <ul class="list-bullets">
                        <li><strong>75 - 100:</strong> Ready for full transition</li>
                        <li><strong>50 - 75:</strong> AI-assisted partial transition (FTE reduction, but not a full replacement)</li>
                        <li><strong>50 and below:</strong> Productivity improvement with AI, but revisit transition at the suggested timeframe</li>
                    </ul>
                </section>

                <div class="grid two-col gap-lg">
                    <section class="panel">
                        <h3>Major AI Handover Tasks</h3>
                        {% if result.automatable_signals %}
                            <ul class="list-bullets">
                                {% for label, _score in result.automatable_signals.items %}
                                    <li>{{ label|humanize_signal }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="empty-state">No strong automation indicators were highlighted for this role.</p>
                        {% endif %}
                    </section>
                    <section class="panel">
                        <h3>Risk Score</h3>
                        {% if result.risk_signals %}
                            <ul class="list-pairs">
                                {% for label, count in result.risk_signals.items %}
                                    <li>
                                        <span>{{ label|humanize_signal }}</span>
                                        <strong>{{ count }}</strong>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="empty-state">No material risk themes surfaced. Focus on stakeholder alignment.</p>
                        {% endif %}
                    </section>
                </div>
                <section class="panel">
                    <div class="panel-header">
                        <h3>Research Guidance</h3>
                    </div>
                    <p>{{ result.research_guidance }}</p>
                    {% if result.research_insights %}
                        <ul class="list-bullets">
                            {% for insight in result.research_insights %}
                                <li>{{ insight }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </section>

                <section class="panel panel--stretch">
                    <div class="panel-header">
                        <h3>Reassessment Guidance</h3>
                        <span class="badge badge--neutral">{{ result.reassessment_time }}</span>
                    </div>
                    <p>{{ result.recommendation }}</p>
                </section>
            </div>
        {% else %}
            <section class="panel empty-panel">
                <h2>No assessment yet</h2>
                <p>Upload a PDF role profile, or paste a role description to generate automation readiness insights.</p>
            </section>
        {% endif %}
    </section>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const reloadButton = document.getElementById("reload-btn");
    if (!reloadButton) {
        return;
    }
    reloadButton.addEventListener("click", () => {
        const resultsContainer = document.getElementById("assessment-results");
        if (resultsContainer) {
            resultsContainer.remove();
        }

        const dashboardMain = document.querySelector(".dashboard-main");
        if (dashboardMain && !dashboardMain.querySelector(".empty-panel")) {
            const placeholder = document.createElement("section");
            placeholder.className = "panel empty-panel";
            placeholder.innerHTML =
                "<h2>No assessment yet</h2><p>Upload a PDF role profile, or paste a role description to generate automation readiness insights.</p>";
            dashboardMain.prepend(placeholder);
        }
    });
});
</script>
{% endblock %}
