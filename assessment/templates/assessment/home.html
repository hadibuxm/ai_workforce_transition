{% extends "base.html" %}

{% block title %}Transition Assessment Tool{% endblock %}

{% block content %}
<div class="dashboard">
    <aside class="dashboard-sidebar">
        <section class="panel panel--compact">
            <h2>Transition Assessment</h2>
            <p class="panel-lead">
                Upload a resume or paste a job description <br> and we&#39;ll evaluate the role for AI transition readiness.
            </p>
            <form method="post" enctype="multipart/form-data" class="assessment-form">
                {% csrf_token %}
                {% if form.non_field_errors %}
                    <div class="form-errors">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="form-field">
                    <label for="{{ form.resume_file.id_for_label }}">{{ form.resume_file.label }}</label>
                    {{ form.resume_file }}
                    {% if form.resume_file.help_text %}
                        <small>{{ form.resume_file.help_text }}</small>
                    {% endif %}
                    {% for error in form.resume_file.errors %}
                        <small class="field-error">{{ error }}</small>
                    {% endfor %}
                </div>
                <div class="form-field">
                    <label for="{{ form.job_description.id_for_label }}">{{ form.job_description.label }}</label>
                    {{ form.job_description }}
                    {% if form.job_description.help_text %}
                        <small>{{ form.job_description.help_text }}</small>
                    {% endif %}
                    {% for error in form.job_description.errors %}
                        <small class="field-error">{{ error }}</small>
                    {% endfor %}
                </div>

                <p class="form-hint">Provide either a resume file or a job description, but not both.</p>

                <button type="submit" class="btn-primary">Run Assessment</button>
            </form>
        </section>
        <section class="panel panel--compact info-card">
            <h3>What you&#39;ll receive</h3>
            <ul>
                <li>Automation readiness score</li>
                <li>Projected time horizon for transition</li>
                <li>Risk profile across compliance, financials, and operations</li>
                <li>Recommended action and follow-up timing</li>
            </ul>
        </section>
    </aside>

    <section class="dashboard-main">
        {% if result %}
            <div class="panel summary-header">
                <div>
                    <p class="summary-label">Transition Readiness Score</p>
                    <p class="summary-score">{{ result.readiness_score }}</p>
                </div>
                <div class="summary-meta">
                    <div>
                        <span class="summary-meta__label">Time Horizon</span>
                        <span class="summary-meta__value">{{ result.time_horizon }}</span>
                    </div>
                    <div>
                        <span class="summary-meta__label">Risk Score</span>
                        <span class="summary-meta__value">{{ result.risk_score }}</span>
                    </div>
                    <div>
                        <span class="summary-meta__label">Recommendation</span>
                        <span class="summary-meta__value">{{ result.recommendation }}</span>
                    </div>
                </div>
            </div>

            <div class="grid two-col gap-lg">
                <section class="panel">
                    <h3>Automation Signals</h3>
                    {% if result.automatable_signals %}
                        <ul class="list-pairs">
                            {% for label, count in result.automatable_signals.items %}
                                <li>
                                    <span>{{ label }}</span>
                                    <strong>{{ count }}</strong>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="empty-state">No strong automation indicators were highlighted for this resume.</p>
                    {% endif %}
                </section>
                <section class="panel">
                    <h3>Risk Considerations</h3>
                    {% if result.risk_signals %}
                        <ul class="list-pairs">
                            {% for label, count in result.risk_signals.items %}
                                <li>
                                    <span>{{ label }}</span>
                                    <strong>{{ count }}</strong>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="empty-state">No material risk themes surfaced. Focus on stakeholder alignment.</p>
                    {% endif %}
                </section>
            </div>

            <section class="panel panel--stretch">
                <div class="panel-header">
                    <h3>Reassessment Guidance</h3>
                    <span class="badge badge--neutral">{{ result.reassessment_time }}</span>
                </div>
                <p>{{ result.recommendation }}</p>
            </section>

            <section class="panel panel--stretch">
                <div class="panel-header">
                    <h3>Duties Sample</h3>
                    <span class="badge badge--accent">{{ result.duty_sample|length }} insights</span>
                </div>
                <ul class="list-bullets">
                    {% for duty in result.duty_sample %}
                        <li>{{ duty }}</li>
                    {% endfor %}
                </ul>
                <details class="resume-sample">
                    <summary>Resume excerpt analyzed</summary>
                    <pre>{{ result.resume_excerpt }}</pre>
                </details>
            </section>

            {% if result.research_insights %}
                <section class="panel panel--stretch">
                    <div class="panel-header">
                        <h3>Research Highlights</h3>
                        <span class="badge badge--info">Web search</span>
                    </div>
                    <ul class="list-bullets">
                        {% for insight in result.research_insights %}
                            <li>{{ insight }}</li>
                        {% endfor %}
                    </ul>
                </section>
            {% endif %}
        {% else %}
            <section class="panel empty-panel">
                <h2>No assessment yet</h2>
                <p>Upload a PDF resume, or paste a job description to generate automation readiness insights.</p>
            </section>
        {% endif %}
    </section>
</div>
{% endblock %}
